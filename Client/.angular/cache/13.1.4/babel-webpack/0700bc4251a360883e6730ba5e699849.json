{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || Object.assign || function (t) {\n  for (var s, i = 1, n = arguments.length; i < n; i++) {\n    s = arguments[i];\n\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n  }\n\n  return t;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar http = require(\"http\");\n\nvar https = require(\"https\");\n\nvar os = require(\"os\");\n\nvar url = require(\"url\");\n\nvar progress_event_1 = require(\"./progress-event\");\n\nvar errors_1 = require(\"./errors\");\n\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\n\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\n\nvar Cookie = require(\"cookiejar\");\n\nvar XMLHttpRequest =\n/** @class */\nfunction (_super) {\n  __extends(XMLHttpRequest, _super);\n\n  function XMLHttpRequest(options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = _super.call(this) || this;\n\n    _this.UNSENT = XMLHttpRequest.UNSENT;\n    _this.OPENED = XMLHttpRequest.OPENED;\n    _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n    _this.LOADING = XMLHttpRequest.LOADING;\n    _this.DONE = XMLHttpRequest.DONE;\n    _this.onreadystatechange = null;\n    _this.readyState = XMLHttpRequest.UNSENT;\n    _this.response = null;\n    _this.responseText = '';\n    _this.responseType = '';\n    _this.status = 0; // TODO: UNSENT?\n\n    _this.statusText = '';\n    _this.timeout = 0;\n    _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n    _this.responseUrl = '';\n    _this.withCredentials = false;\n    _this._method = null;\n    _this._url = null;\n    _this._sync = false;\n    _this._headers = {};\n    _this._loweredHeaders = {};\n    _this._mimeOverride = null; // TODO: is type right?\n\n    _this._request = null;\n    _this._response = null;\n    _this._responseParts = null;\n    _this._responseHeaders = null;\n    _this._aborting = null; // TODO: type?\n\n    _this._error = null; // TODO: type?\n\n    _this._loadedBytes = 0;\n    _this._totalBytes = 0;\n    _this._lengthComputable = false;\n    _this._restrictedMethods = {\n      CONNECT: true,\n      TRACE: true,\n      TRACK: true\n    };\n    _this._restrictedHeaders = {\n      'accept-charset': true,\n      'accept-encoding': true,\n      'access-control-request-headers': true,\n      'access-control-request-method': true,\n      connection: true,\n      'content-length': true,\n      cookie: true,\n      cookie2: true,\n      date: true,\n      dnt: true,\n      expect: true,\n      host: true,\n      'keep-alive': true,\n      origin: true,\n      referer: true,\n      te: true,\n      trailer: true,\n      'transfer-encoding': true,\n      upgrade: true,\n      'user-agent': true,\n      via: true\n    };\n    _this._privateHeaders = {\n      'set-cookie': true,\n      'set-cookie2': true\n    };\n    _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n    _this._anonymous = options.anon || false;\n    return _this;\n  }\n\n  XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n    if (async === void 0) {\n      async = true;\n    }\n\n    method = method.toUpperCase();\n\n    if (this._restrictedMethods[method]) {\n      throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n    }\n\n    ;\n\n    var xhrUrl = this._parseUrl(url, user, password);\n\n    if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {// TODO(pwnall): terminate abort(), terminate send()\n    }\n\n    this._method = method;\n    this._url = xhrUrl;\n    this._sync = !async;\n    this._headers = {};\n    this._loweredHeaders = {};\n    this._mimeOverride = null;\n\n    this._setReadyState(XMLHttpRequest.OPENED);\n\n    this._request = null;\n    this._response = null;\n    this.status = 0;\n    this.statusText = '';\n    this._responseParts = [];\n    this._responseHeaders = null;\n    this._loadedBytes = 0;\n    this._totalBytes = 0;\n    this._lengthComputable = false;\n  };\n\n  XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n\n    var loweredName = name.toLowerCase();\n\n    if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n      console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n      return;\n    }\n\n    value = value.toString();\n\n    if (this._loweredHeaders[loweredName] != null) {\n      name = this._loweredHeaders[loweredName];\n      this._headers[name] = this._headers[name] + \", \" + value;\n    } else {\n      this._loweredHeaders[loweredName] = name;\n      this._headers[name] = value;\n    }\n  };\n\n  XMLHttpRequest.prototype.send = function (data) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n\n    if (this._request) {\n      throw new XMLHttpRequest.InvalidStateError('send() already called');\n    }\n\n    switch (this._url.protocol) {\n      case 'file:':\n        return this._sendFile(data);\n\n      case 'http:':\n      case 'https:':\n        return this._sendHttp(data);\n\n      default:\n        throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n    }\n  };\n\n  XMLHttpRequest.prototype.abort = function () {\n    if (this._request == null) {\n      return;\n    }\n\n    this._request.abort();\n\n    this._setError();\n\n    this._dispatchProgress('abort');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype.getResponseHeader = function (name) {\n    if (this._responseHeaders == null || name == null) {\n      return null;\n    }\n\n    var loweredName = name.toLowerCase();\n    return this._responseHeaders.hasOwnProperty(loweredName) ? this._responseHeaders[name.toLowerCase()] : null;\n  };\n\n  XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n    var _this = this;\n\n    if (this._responseHeaders == null) {\n      return '';\n    }\n\n    return Object.keys(this._responseHeaders).map(function (key) {\n      return key + \": \" + _this._responseHeaders[key];\n    }).join('\\r\\n');\n  };\n\n  XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n    if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n      throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n    }\n\n    this._mimeOverride = mimeType.toLowerCase();\n  };\n\n  XMLHttpRequest.prototype.nodejsSet = function (options) {\n    this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n    this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n\n    if (options.hasOwnProperty('baseUrl')) {\n      if (options.baseUrl != null) {\n        var parsedUrl = url.parse(options.baseUrl, false, true);\n\n        if (!parsedUrl.protocol) {\n          throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n        }\n      }\n\n      this.nodejsBaseUrl = options.baseUrl;\n    }\n  };\n\n  XMLHttpRequest.nodejsSet = function (options) {\n    XMLHttpRequest.prototype.nodejsSet(options);\n  };\n\n  XMLHttpRequest.prototype._setReadyState = function (readyState) {\n    this.readyState = readyState;\n    this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n  };\n\n  XMLHttpRequest.prototype._sendFile = function (data) {\n    // TODO\n    throw new Error('Protocol file: not implemented');\n  };\n\n  XMLHttpRequest.prototype._sendHttp = function (data) {\n    if (this._sync) {\n      throw new Error('Synchronous XHR processing not implemented');\n    }\n\n    if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n      console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n      data = null;\n    } else {\n      data = data || '';\n    }\n\n    this.upload._setData(data);\n\n    this._finalizeHeaders();\n\n    this._sendHxxpRequest();\n  };\n\n  XMLHttpRequest.prototype._sendHxxpRequest = function () {\n    var _this = this;\n\n    if (this.withCredentials) {\n      var cookie = XMLHttpRequest.cookieJar.getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n      this._headers.cookie = this._headers.cookie2 = cookie;\n    }\n\n    var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent],\n        hxxp = _a[0],\n        agent = _a[1];\n\n    var requestMethod = hxxp.request.bind(hxxp);\n    var request = requestMethod({\n      hostname: this._url.hostname,\n      port: +this._url.port,\n      path: this._url.path,\n      auth: this._url.auth,\n      method: this._method,\n      headers: this._headers,\n      agent: agent\n    });\n    this._request = request;\n\n    if (this.timeout) {\n      request.setTimeout(this.timeout, function () {\n        return _this._onHttpTimeout(request);\n      });\n    }\n\n    request.on('response', function (response) {\n      return _this._onHttpResponse(request, response);\n    });\n    request.on('error', function (error) {\n      return _this._onHttpRequestError(request, error);\n    });\n\n    this.upload._startUpload(request);\n\n    if (this._request === request) {\n      this._dispatchProgress('loadstart');\n    }\n  };\n\n  XMLHttpRequest.prototype._finalizeHeaders = function () {\n    this._headers = __assign({}, this._headers, {\n      Connection: 'keep-alive',\n      Host: this._url.host,\n      'User-Agent': this._userAgent\n    }, this._anonymous ? {\n      Referer: 'about:blank'\n    } : {});\n\n    this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n  };\n\n  XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n    var _this = this;\n\n    if (this._request !== request) {\n      return;\n    }\n\n    if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n      XMLHttpRequest.cookieJar.setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n    }\n\n    if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n      this._url = this._parseUrl(response.headers.location);\n      this._method = 'GET';\n\n      if (this._loweredHeaders['content-type']) {\n        delete this._headers[this._loweredHeaders['content-type']];\n        delete this._loweredHeaders['content-type'];\n      }\n\n      if (this._headers['Content-Type'] != null) {\n        delete this._headers['Content-Type'];\n      }\n\n      delete this._headers['Content-Length'];\n\n      this.upload._reset();\n\n      this._finalizeHeaders();\n\n      this._sendHxxpRequest();\n\n      return;\n    }\n\n    this._response = response;\n\n    this._response.on('data', function (data) {\n      return _this._onHttpResponseData(response, data);\n    });\n\n    this._response.on('end', function () {\n      return _this._onHttpResponseEnd(response);\n    });\n\n    this._response.on('close', function () {\n      return _this._onHttpResponseClose(response);\n    });\n\n    this.responseUrl = this._url.href.split('#')[0];\n    this.status = response.statusCode;\n    this.statusText = http.STATUS_CODES[this.status];\n\n    this._parseResponseHeaders(response);\n\n    var lengthString = this._responseHeaders['content-length'] || '';\n    this._totalBytes = +lengthString;\n    this._lengthComputable = !!lengthString;\n\n    this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n    if (this._response !== response) {\n      return;\n    }\n\n    this._responseParts.push(new Buffer(data));\n\n    this._loadedBytes += data.length;\n\n    if (this.readyState !== XMLHttpRequest.LOADING) {\n      this._setReadyState(XMLHttpRequest.LOADING);\n    }\n\n    this._dispatchProgress('progress');\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n\n    this._parseResponse();\n\n    this._request = null;\n    this._response = null;\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('load');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n\n    var request = this._request;\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('error');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n    if (this._request !== request) {\n      return;\n    }\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('timeout');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n    if (this._request !== request) {\n      return;\n    }\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('error');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n    var event = new XMLHttpRequest.ProgressEvent(eventType);\n    event.lengthComputable = this._lengthComputable;\n    event.loaded = this._loadedBytes;\n    event.total = this._totalBytes;\n    this.dispatchEvent(event);\n  };\n\n  XMLHttpRequest.prototype._setError = function () {\n    this._request = null;\n    this._response = null;\n    this._responseHeaders = null;\n    this._responseParts = null;\n  };\n\n  XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n    var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n    var xhrUrl = url.parse(absoluteUrl, false, true);\n    xhrUrl.hash = null;\n\n    var _a = (xhrUrl.auth || '').split(':'),\n        xhrUser = _a[0],\n        xhrPassword = _a[1];\n\n    if (xhrUser || xhrPassword || user || password) {\n      xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n    }\n\n    return xhrUrl;\n  };\n\n  XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n    this._responseHeaders = {};\n\n    for (var name_1 in response.headers) {\n      var loweredName = name_1.toLowerCase();\n\n      if (this._privateHeaders[loweredName]) {\n        continue;\n      }\n\n      this._responseHeaders[loweredName] = response.headers[name_1];\n    }\n\n    if (this._mimeOverride != null) {\n      this._responseHeaders['content-type'] = this._mimeOverride;\n    }\n  };\n\n  XMLHttpRequest.prototype._parseResponse = function () {\n    var buffer = Buffer.concat(this._responseParts);\n    this._responseParts = null;\n\n    switch (this.responseType) {\n      case 'json':\n        this.responseText = null;\n\n        try {\n          this.response = JSON.parse(buffer.toString('utf-8'));\n        } catch (_a) {\n          this.response = null;\n        }\n\n        return;\n\n      case 'buffer':\n        this.responseText = null;\n        this.response = buffer;\n        return;\n\n      case 'arraybuffer':\n        this.responseText = null;\n        var arrayBuffer = new ArrayBuffer(buffer.length);\n        var view = new Uint8Array(arrayBuffer);\n\n        for (var i = 0; i < buffer.length; i++) {\n          view[i] = buffer[i];\n        }\n\n        this.response = arrayBuffer;\n        return;\n\n      case 'text':\n      default:\n        try {\n          this.responseText = buffer.toString(this._parseResponseEncoding());\n        } catch (_b) {\n          this.responseText = buffer.toString('binary');\n        }\n\n        this.response = this.responseText;\n    }\n  };\n\n  XMLHttpRequest.prototype._parseResponseEncoding = function () {\n    return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n  };\n\n  XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n  XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n  XMLHttpRequest.NetworkError = errors_1.NetworkError;\n  XMLHttpRequest.SecurityError = errors_1.SecurityError;\n  XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n  XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n  XMLHttpRequest.UNSENT = 0;\n  XMLHttpRequest.OPENED = 1;\n  XMLHttpRequest.HEADERS_RECEIVED = 2;\n  XMLHttpRequest.LOADING = 3;\n  XMLHttpRequest.DONE = 4;\n  XMLHttpRequest.cookieJar = Cookie.CookieJar();\n  return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget);\n\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;","map":{"version":3,"sources":["/Users/nani/Desktop/EHR-2.0/Client/node_modules/xhr2-cookies/dist/xml-http-request.js"],"names":["__extends","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","defineProperty","exports","value","http","require","https","os","url","progress_event_1","errors_1","xml_http_request_event_target_1","xml_http_request_upload_1","Cookie","XMLHttpRequest","_super","options","_this","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","onreadystatechange","readyState","response","responseText","responseType","status","statusText","timeout","upload","XMLHttpRequestUpload","responseUrl","withCredentials","_method","_url","_sync","_headers","_loweredHeaders","_mimeOverride","_request","_response","_responseParts","_responseHeaders","_aborting","_error","_loadedBytes","_totalBytes","_lengthComputable","_restrictedMethods","CONNECT","TRACE","TRACK","_restrictedHeaders","connection","cookie","cookie2","date","dnt","expect","host","origin","referer","te","trailer","upgrade","via","_privateHeaders","_userAgent","type","arch","process","versions","node","v8","_anonymous","anon","open","method","async","user","password","toUpperCase","SecurityError","xhrUrl","_parseUrl","_setReadyState","setRequestHeader","name","InvalidStateError","loweredName","toLowerCase","test","console","warn","toString","send","data","protocol","_sendFile","_sendHttp","NetworkError","abort","_setError","_dispatchProgress","getResponseHeader","getAllResponseHeaders","keys","map","key","join","overrideMimeType","mimeType","nodejsSet","nodejsHttpAgent","httpAgent","nodejsHttpsAgent","httpsAgent","baseUrl","parsedUrl","parse","SyntaxError","nodejsBaseUrl","dispatchEvent","ProgressEvent","Error","_setData","_finalizeHeaders","_sendHxxpRequest","cookieJar","getCookies","CookieAccessInfo","hostname","pathname","toValueString","_a","hxxp","agent","requestMethod","request","bind","port","path","auth","headers","setTimeout","_onHttpTimeout","on","_onHttpResponse","error","_onHttpRequestError","_startUpload","Connection","Host","Referer","setCookies","indexOf","statusCode","location","_reset","_onHttpResponseData","_onHttpResponseEnd","_onHttpResponseClose","href","split","STATUS_CODES","_parseResponseHeaders","lengthString","push","Buffer","_parseResponse","eventType","event","lengthComputable","loaded","total","urlString","absoluteUrl","resolve","hash","xhrUser","xhrPassword","name_1","buffer","concat","JSON","arrayBuffer","ArrayBuffer","view","Uint8Array","_parseResponseEncoding","_b","exec","CookieJar","XMLHttpRequestEventTarget","globalAgent"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar os = require(\"os\");\nvar url = require(\"url\");\nvar progress_event_1 = require(\"./progress-event\");\nvar errors_1 = require(\"./errors\");\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\nvar Cookie = require(\"cookiejar\");\nvar XMLHttpRequest = /** @class */ (function (_super) {\n    __extends(XMLHttpRequest, _super);\n    function XMLHttpRequest(options) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this) || this;\n        _this.UNSENT = XMLHttpRequest.UNSENT;\n        _this.OPENED = XMLHttpRequest.OPENED;\n        _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n        _this.LOADING = XMLHttpRequest.LOADING;\n        _this.DONE = XMLHttpRequest.DONE;\n        _this.onreadystatechange = null;\n        _this.readyState = XMLHttpRequest.UNSENT;\n        _this.response = null;\n        _this.responseText = '';\n        _this.responseType = '';\n        _this.status = 0; // TODO: UNSENT?\n        _this.statusText = '';\n        _this.timeout = 0;\n        _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n        _this.responseUrl = '';\n        _this.withCredentials = false;\n        _this._method = null;\n        _this._url = null;\n        _this._sync = false;\n        _this._headers = {};\n        _this._loweredHeaders = {};\n        _this._mimeOverride = null; // TODO: is type right?\n        _this._request = null;\n        _this._response = null;\n        _this._responseParts = null;\n        _this._responseHeaders = null;\n        _this._aborting = null; // TODO: type?\n        _this._error = null; // TODO: type?\n        _this._loadedBytes = 0;\n        _this._totalBytes = 0;\n        _this._lengthComputable = false;\n        _this._restrictedMethods = { CONNECT: true, TRACE: true, TRACK: true };\n        _this._restrictedHeaders = {\n            'accept-charset': true,\n            'accept-encoding': true,\n            'access-control-request-headers': true,\n            'access-control-request-method': true,\n            connection: true,\n            'content-length': true,\n            cookie: true,\n            cookie2: true,\n            date: true,\n            dnt: true,\n            expect: true,\n            host: true,\n            'keep-alive': true,\n            origin: true,\n            referer: true,\n            te: true,\n            trailer: true,\n            'transfer-encoding': true,\n            upgrade: true,\n            'user-agent': true,\n            via: true\n        };\n        _this._privateHeaders = { 'set-cookie': true, 'set-cookie2': true };\n        _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n        _this._anonymous = options.anon || false;\n        return _this;\n    }\n    XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n        if (async === void 0) { async = true; }\n        method = method.toUpperCase();\n        if (this._restrictedMethods[method]) {\n            throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n        }\n        ;\n        var xhrUrl = this._parseUrl(url, user, password);\n        if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {\n            // TODO(pwnall): terminate abort(), terminate send()\n        }\n        this._method = method;\n        this._url = xhrUrl;\n        this._sync = !async;\n        this._headers = {};\n        this._loweredHeaders = {};\n        this._mimeOverride = null;\n        this._setReadyState(XMLHttpRequest.OPENED);\n        this._request = null;\n        this._response = null;\n        this.status = 0;\n        this.statusText = '';\n        this._responseParts = [];\n        this._responseHeaders = null;\n        this._loadedBytes = 0;\n        this._totalBytes = 0;\n        this._lengthComputable = false;\n    };\n    XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        var loweredName = name.toLowerCase();\n        if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n            console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n            return;\n        }\n        value = value.toString();\n        if (this._loweredHeaders[loweredName] != null) {\n            name = this._loweredHeaders[loweredName];\n            this._headers[name] = this._headers[name] + \", \" + value;\n        }\n        else {\n            this._loweredHeaders[loweredName] = name;\n            this._headers[name] = value;\n        }\n    };\n    XMLHttpRequest.prototype.send = function (data) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        if (this._request) {\n            throw new XMLHttpRequest.InvalidStateError('send() already called');\n        }\n        switch (this._url.protocol) {\n            case 'file:':\n                return this._sendFile(data);\n            case 'http:':\n            case 'https:':\n                return this._sendHttp(data);\n            default:\n                throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n        }\n    };\n    XMLHttpRequest.prototype.abort = function () {\n        if (this._request == null) {\n            return;\n        }\n        this._request.abort();\n        this._setError();\n        this._dispatchProgress('abort');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype.getResponseHeader = function (name) {\n        if (this._responseHeaders == null || name == null) {\n            return null;\n        }\n        var loweredName = name.toLowerCase();\n        return this._responseHeaders.hasOwnProperty(loweredName)\n            ? this._responseHeaders[name.toLowerCase()]\n            : null;\n    };\n    XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n        var _this = this;\n        if (this._responseHeaders == null) {\n            return '';\n        }\n        return Object.keys(this._responseHeaders).map(function (key) { return key + \": \" + _this._responseHeaders[key]; }).join('\\r\\n');\n    };\n    XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n        if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n            throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n        }\n        this._mimeOverride = mimeType.toLowerCase();\n    };\n    XMLHttpRequest.prototype.nodejsSet = function (options) {\n        this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n        this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n        if (options.hasOwnProperty('baseUrl')) {\n            if (options.baseUrl != null) {\n                var parsedUrl = url.parse(options.baseUrl, false, true);\n                if (!parsedUrl.protocol) {\n                    throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n                }\n            }\n            this.nodejsBaseUrl = options.baseUrl;\n        }\n    };\n    XMLHttpRequest.nodejsSet = function (options) {\n        XMLHttpRequest.prototype.nodejsSet(options);\n    };\n    XMLHttpRequest.prototype._setReadyState = function (readyState) {\n        this.readyState = readyState;\n        this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n    };\n    XMLHttpRequest.prototype._sendFile = function (data) {\n        // TODO\n        throw new Error('Protocol file: not implemented');\n    };\n    XMLHttpRequest.prototype._sendHttp = function (data) {\n        if (this._sync) {\n            throw new Error('Synchronous XHR processing not implemented');\n        }\n        if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n            console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n            data = null;\n        }\n        else {\n            data = data || '';\n        }\n        this.upload._setData(data);\n        this._finalizeHeaders();\n        this._sendHxxpRequest();\n    };\n    XMLHttpRequest.prototype._sendHxxpRequest = function () {\n        var _this = this;\n        if (this.withCredentials) {\n            var cookie = XMLHttpRequest.cookieJar\n                .getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n            this._headers.cookie = this._headers.cookie2 = cookie;\n        }\n        var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent], hxxp = _a[0], agent = _a[1];\n        var requestMethod = hxxp.request.bind(hxxp);\n        var request = requestMethod({\n            hostname: this._url.hostname,\n            port: +this._url.port,\n            path: this._url.path,\n            auth: this._url.auth,\n            method: this._method,\n            headers: this._headers,\n            agent: agent\n        });\n        this._request = request;\n        if (this.timeout) {\n            request.setTimeout(this.timeout, function () { return _this._onHttpTimeout(request); });\n        }\n        request.on('response', function (response) { return _this._onHttpResponse(request, response); });\n        request.on('error', function (error) { return _this._onHttpRequestError(request, error); });\n        this.upload._startUpload(request);\n        if (this._request === request) {\n            this._dispatchProgress('loadstart');\n        }\n    };\n    XMLHttpRequest.prototype._finalizeHeaders = function () {\n        this._headers = __assign({}, this._headers, { Connection: 'keep-alive', Host: this._url.host, 'User-Agent': this._userAgent }, this._anonymous ? { Referer: 'about:blank' } : {});\n        this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n    };\n    XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n        var _this = this;\n        if (this._request !== request) {\n            return;\n        }\n        if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n            XMLHttpRequest.cookieJar\n                .setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n        }\n        if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n            this._url = this._parseUrl(response.headers.location);\n            this._method = 'GET';\n            if (this._loweredHeaders['content-type']) {\n                delete this._headers[this._loweredHeaders['content-type']];\n                delete this._loweredHeaders['content-type'];\n            }\n            if (this._headers['Content-Type'] != null) {\n                delete this._headers['Content-Type'];\n            }\n            delete this._headers['Content-Length'];\n            this.upload._reset();\n            this._finalizeHeaders();\n            this._sendHxxpRequest();\n            return;\n        }\n        this._response = response;\n        this._response.on('data', function (data) { return _this._onHttpResponseData(response, data); });\n        this._response.on('end', function () { return _this._onHttpResponseEnd(response); });\n        this._response.on('close', function () { return _this._onHttpResponseClose(response); });\n        this.responseUrl = this._url.href.split('#')[0];\n        this.status = response.statusCode;\n        this.statusText = http.STATUS_CODES[this.status];\n        this._parseResponseHeaders(response);\n        var lengthString = this._responseHeaders['content-length'] || '';\n        this._totalBytes = +lengthString;\n        this._lengthComputable = !!lengthString;\n        this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n    };\n    XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n        if (this._response !== response) {\n            return;\n        }\n        this._responseParts.push(new Buffer(data));\n        this._loadedBytes += data.length;\n        if (this.readyState !== XMLHttpRequest.LOADING) {\n            this._setReadyState(XMLHttpRequest.LOADING);\n        }\n        this._dispatchProgress('progress');\n    };\n    XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        this._parseResponse();\n        this._request = null;\n        this._response = null;\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('load');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        var request = this._request;\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('timeout');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n        var event = new XMLHttpRequest.ProgressEvent(eventType);\n        event.lengthComputable = this._lengthComputable;\n        event.loaded = this._loadedBytes;\n        event.total = this._totalBytes;\n        this.dispatchEvent(event);\n    };\n    XMLHttpRequest.prototype._setError = function () {\n        this._request = null;\n        this._response = null;\n        this._responseHeaders = null;\n        this._responseParts = null;\n    };\n    XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n        var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n        var xhrUrl = url.parse(absoluteUrl, false, true);\n        xhrUrl.hash = null;\n        var _a = (xhrUrl.auth || '').split(':'), xhrUser = _a[0], xhrPassword = _a[1];\n        if (xhrUser || xhrPassword || user || password) {\n            xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n        }\n        return xhrUrl;\n    };\n    XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n        this._responseHeaders = {};\n        for (var name_1 in response.headers) {\n            var loweredName = name_1.toLowerCase();\n            if (this._privateHeaders[loweredName]) {\n                continue;\n            }\n            this._responseHeaders[loweredName] = response.headers[name_1];\n        }\n        if (this._mimeOverride != null) {\n            this._responseHeaders['content-type'] = this._mimeOverride;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponse = function () {\n        var buffer = Buffer.concat(this._responseParts);\n        this._responseParts = null;\n        switch (this.responseType) {\n            case 'json':\n                this.responseText = null;\n                try {\n                    this.response = JSON.parse(buffer.toString('utf-8'));\n                }\n                catch (_a) {\n                    this.response = null;\n                }\n                return;\n            case 'buffer':\n                this.responseText = null;\n                this.response = buffer;\n                return;\n            case 'arraybuffer':\n                this.responseText = null;\n                var arrayBuffer = new ArrayBuffer(buffer.length);\n                var view = new Uint8Array(arrayBuffer);\n                for (var i = 0; i < buffer.length; i++) {\n                    view[i] = buffer[i];\n                }\n                this.response = arrayBuffer;\n                return;\n            case 'text':\n            default:\n                try {\n                    this.responseText = buffer.toString(this._parseResponseEncoding());\n                }\n                catch (_b) {\n                    this.responseText = buffer.toString('binary');\n                }\n                this.response = this.responseText;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponseEncoding = function () {\n        return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n    };\n    XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n    XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n    XMLHttpRequest.NetworkError = errors_1.NetworkError;\n    XMLHttpRequest.SecurityError = errors_1.SecurityError;\n    XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n    XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n    XMLHttpRequest.UNSENT = 0;\n    XMLHttpRequest.OPENED = 1;\n    XMLHttpRequest.HEADERS_RECEIVED = 2;\n    XMLHttpRequest.LOADING = 3;\n    XMLHttpRequest.DONE = 4;\n    XMLHttpRequest.cookieJar = Cookie.CookieJar();\n    return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget));\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;\n"]},"metadata":{},"sourceType":"script"}